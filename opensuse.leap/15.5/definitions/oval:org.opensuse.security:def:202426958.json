{
	"id": "oval:org.opensuse.security:def:202426958",
	"version": "1",
	"class": "vulnerability",
	"metadata": {
		"title": "CVE-2024-26958",
		"affected": {
			"family": "unix",
			"platform": [
				"openSUSE Leap 15.5"
			]
		},
		"reference": [
			{
				"ref_id": "Mitre CVE-2024-26958",
				"ref_url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-26958",
				"source": "CVE"
			},
			{
				"ref_id": "SUSE CVE-2024-26958",
				"ref_url": "https://www.suse.com/security/cve/CVE-2024-26958",
				"source": "SUSE CVE"
			},
			{
				"ref_id": "SUSE-SU-2024:1979-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-June/035536.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:1983-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-June/035554.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:2008-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-June/035569.html",
				"source": "SUSE-SU"
			}
		],
		"description": "\n    In the Linux kernel, the following vulnerability has been resolved:\n\nnfs: fix UAF in direct writes\n\nIn production we have been hitting the following warning consistently\n\n------------[ cut here ]------------\nrefcount_t: underflow; use-after-free.\nWARNING: CPU: 17 PID: 1800359 at lib/refcount.c:28 refcount_warn_saturate+0x9c/0xe0\nWorkqueue: nfsiod nfs_direct_write_schedule_work [nfs]\nRIP: 0010:refcount_warn_saturate+0x9c/0xe0\nPKRU: 55555554\nCall Trace:\n <TASK>\n ? __warn+0x9f/0x130\n ? refcount_warn_saturate+0x9c/0xe0\n ? report_bug+0xcc/0x150\n ? handle_bug+0x3d/0x70\n ? exc_invalid_op+0x16/0x40\n ? asm_exc_invalid_op+0x16/0x20\n ? refcount_warn_saturate+0x9c/0xe0\n nfs_direct_write_schedule_work+0x237/0x250 [nfs]\n process_one_work+0x12f/0x4a0\n worker_thread+0x14e/0x3b0\n ? ZSTD_getCParams_internal+0x220/0x220\n kthread+0xdc/0x120\n ? __btf_name_valid+0xa0/0xa0\n ret_from_fork+0x1f/0x30\n\nThis is because we're completing the nfs_direct_request twice in a row.\n\nThe source of this is when we have our commit requests to submit, we\nprocess them and send them off, and then in the completion path for the\ncommit requests we have\n\nif (nfs_commit_end(cinfo.mds))\n\tnfs_direct_write_complete(dreq);\n\nHowever since we're submitting asynchronous requests we sometimes have\none that completes before we submit the next one, so we end up calling\ncomplete on the nfs_direct_request twice.\n\nThe only other place we use nfs_generic_commit_list() is in\n__nfs_commit_inode, which wraps this call in a\n\nnfs_commit_begin();\nnfs_commit_end();\n\nWhich is a common pattern for this style of completion handling, one\nthat is also repeated in the direct code with get_dreq()/put_dreq()\ncalls around where we process events as well as in the completion paths.\n\nFix this by using the same pattern for the commit requests.\n\nBefore with my 200 node rocksdb stress running this warning would pop\nevery 10ish minutes.  With my patch the stress test has been running for\nseveral hours without popping.\n    ",
		"advisory": {
			"from": "security@suse.de",
			"severity": "Moderate",
			"cve": [
				{
					"text": "CVE-2024-26958 at SUSE",
					"href": "https://www.suse.com/security/cve/CVE-2024-26958/",
					"impact": "medium",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
				},
				{
					"text": "CVE-2024-26958 at NVD",
					"href": "https://nvd.nist.gov/vuln/detail/CVE-2024-26958"
				}
			],
			"bugzilla": [
				{
					"text": "SUSE bug 1223653",
					"href": "https://bugzilla.suse.com/1223653"
				}
			],
			"issued": {
				"date": "2024-06-13"
			},
			"updated": {
				"date": "2024-06-13"
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/o:opensuse:leap:15.5"
				]
			}
		}
	},
	"criteria": {
		"operator": "AND",
		"criterias": [
			{
				"operator": "OR",
				"criterias": [
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865615",
								"comment": "cluster-md-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342853",
								"comment": "cluster-md-kmp-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865616",
								"comment": "dlm-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342855",
								"comment": "dlm-kmp-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865617",
								"comment": "gfs2-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342857",
								"comment": "gfs2-kmp-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865618",
								"comment": "kernel-devel-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342859",
								"comment": "kernel-devel-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865619",
								"comment": "kernel-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342860",
								"comment": "kernel-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865620",
								"comment": "kernel-rt-devel-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342861",
								"comment": "kernel-rt-devel is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865621",
								"comment": "kernel-rt-extra-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342862",
								"comment": "kernel-rt-extra is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865622",
								"comment": "kernel-rt-livepatch-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009771783",
								"comment": "kernel-rt-livepatch is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865623",
								"comment": "kernel-rt-livepatch-devel-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009623297",
								"comment": "kernel-rt-livepatch-devel is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865624",
								"comment": "kernel-rt-optional-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009771784",
								"comment": "kernel-rt-optional is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865625",
								"comment": "kernel-rt-vdso-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009771785",
								"comment": "kernel-rt-vdso is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865626",
								"comment": "kernel-rt_debug-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342863",
								"comment": "kernel-rt_debug is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865627",
								"comment": "kernel-rt_debug-devel-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342864",
								"comment": "kernel-rt_debug-devel is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865628",
								"comment": "kernel-rt_debug-livepatch-devel-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009623299",
								"comment": "kernel-rt_debug-livepatch-devel is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865629",
								"comment": "kernel-rt_debug-vdso-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009771786",
								"comment": "kernel-rt_debug-vdso is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865630",
								"comment": "kernel-source-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342866",
								"comment": "kernel-source-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865631",
								"comment": "kernel-syms-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342867",
								"comment": "kernel-syms-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865632",
								"comment": "kselftests-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342868",
								"comment": "kselftests-kmp-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865633",
								"comment": "ocfs2-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342870",
								"comment": "ocfs2-kmp-rt is signed with openSUSE key"
							}
						]
					},
					{
						"operator": "AND",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009865634",
								"comment": "reiserfs-kmp-rt-5.14.21-150500.13.58.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009342872",
								"comment": "reiserfs-kmp-rt is signed with openSUSE key"
							}
						]
					}
				]
			}
		],
		"criterions": [
			{
				"test_ref": "oval:org.opensuse.security:tst:2009752682",
				"comment": "openSUSE Leap 15.5 is installed"
			}
		]
	}
}
