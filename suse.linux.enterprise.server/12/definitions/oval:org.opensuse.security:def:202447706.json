{
	"id": "oval:org.opensuse.security:def:202447706",
	"version": "1",
	"class": "vulnerability",
	"metadata": {
		"title": "CVE-2024-47706",
		"affected": {
			"family": "unix",
			"platform": [
				"SUSE Linux Enterprise High Performance Computing 12",
				"SUSE Linux Enterprise Live Patching 12 SP5",
				"SUSE Linux Enterprise Module for Public Cloud 12",
				"SUSE Linux Enterprise Real Time 12 SP5",
				"SUSE Linux Enterprise Server 12",
				"SUSE Linux Enterprise Server 12 SP2-LTSS",
				"SUSE Linux Enterprise Server 12 SP3",
				"SUSE Linux Enterprise Server 12 SP4",
				"SUSE Linux Enterprise Server 12 SP4-LTSS",
				"SUSE Linux Enterprise Server 12 SP5",
				"SUSE Linux Enterprise Server 12 SP5-LTSS",
				"SUSE Linux Enterprise Server for SAP Applications 12",
				"SUSE Linux Enterprise Server for SAP Applications 12 SP3",
				"SUSE Linux Enterprise Server for SAP Applications 12 SP4",
				"SUSE Linux Enterprise Server for SAP Applications 12 SP5",
				"SUSE Linux Enterprise Workstation Extension 12 SP5"
			]
		},
		"reference": [
			{
				"ref_id": "Mitre CVE-2024-47706",
				"ref_url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47706",
				"source": "CVE"
			},
			{
				"ref_id": "SUSE CVE-2024-47706",
				"ref_url": "https://www.suse.com/security/cve/CVE-2024-47706",
				"source": "SUSE CVE"
			},
			{
				"ref_id": "SUSE-SU-2024:3983-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019816.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:3984-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019815.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:3985-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019814.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:3986-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019813.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:4081-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019852.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:4082-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-November/019851.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "openSUSE-SU-2024:14500-1",
				"ref_url": "https://lists.opensuse.org/archives/list/security-announce@lists.opensuse.org/thread/2NO44GTYBSPPWKFDREFWHITK4XKTNVLP/",
				"source": "SUSE-SU"
			}
		],
		"description": "\n    In the Linux kernel, the following vulnerability has been resolved:\n\nblock, bfq: fix possible UAF for bfqq->bic with merge chain\n\n1) initial state, three tasks:\n\n\t\tProcess 1       Process 2\tProcess 3\n\t\t (BIC1)          (BIC2)\t\t (BIC3)\n\t\t  |  Λ            |  Λ\t\t  |  Λ\n\t\t  |  |            |  |\t\t  |  |\n\t\t  V  |            V  |\t\t  V  |\n\t\t  bfqq1           bfqq2\t\t  bfqq3\nprocess ref:\t   1\t\t    1\t\t    1\n\n2) bfqq1 merged to bfqq2:\n\n\t\tProcess 1       Process 2\tProcess 3\n\t\t (BIC1)          (BIC2)\t\t (BIC3)\n\t\t  |               |\t\t  |  Λ\n\t\t  \\--------------\\|\t\t  |  |\n\t\t                  V\t\t  V  |\n\t\t  bfqq1--------->bfqq2\t\t  bfqq3\nprocess ref:\t   0\t\t    2\t\t    1\n\n3) bfqq2 merged to bfqq3:\n\n\t\tProcess 1       Process 2\tProcess 3\n\t\t (BIC1)          (BIC2)\t\t (BIC3)\n\t here -> Λ                |\t\t  |\n\t\t  \\--------------\\ \\-------------\\|\n\t\t                  V\t\t  V\n\t\t  bfqq1--------->bfqq2---------->bfqq3\nprocess ref:\t   0\t\t    1\t\t    3\n\nIn this case, IO from Process 1 will get bfqq2 from BIC1 first, and then\nget bfqq3 through merge chain, and finially handle IO by bfqq3.\nHowerver, current code will think bfqq2 is owned by BIC1, like initial\nstate, and set bfqq2->bic to BIC1.\n\nbfq_insert_request\n-> by Process 1\n bfqq = bfq_init_rq(rq)\n  bfqq = bfq_get_bfqq_handle_split\n   bfqq = bic_to_bfqq\n   -> get bfqq2 from BIC1\n bfqq->ref++\n rq->elv.priv[0] = bic\n rq->elv.priv[1] = bfqq\n if (bfqq_process_refs(bfqq) == 1)\n  bfqq->bic = bic\n  -> record BIC1 to bfqq2\n\n  __bfq_insert_request\n   new_bfqq = bfq_setup_cooperator\n   -> get bfqq3 from bfqq2->new_bfqq\n   bfqq_request_freed(bfqq)\n   new_bfqq->ref++\n   rq->elv.priv[1] = new_bfqq\n   -> handle IO by bfqq3\n\nFix the problem by checking bfqq is from merge chain fist. And this\nmight fix a following problem reported by our syzkaller(unreproducible):\n\n==================================================================\nBUG: KASAN: slab-use-after-free in bfq_do_early_stable_merge block/bfq-iosched.c:5692 [inline]\nBUG: KASAN: slab-use-after-free in bfq_do_or_sched_stable_merge block/bfq-iosched.c:5805 [inline]\nBUG: KASAN: slab-use-after-free in bfq_get_queue+0x25b0/0x2610 block/bfq-iosched.c:5889\nWrite of size 1 at addr ffff888123839eb8 by task kworker/0:1H/18595\n\nCPU: 0 PID: 18595 Comm: kworker/0:1H Tainted: G             L     6.6.0-07439-gba2303cacfda #6\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.14.0-0-g155821a1990b-prebuilt.qemu.org 04/01/2014\nWorkqueue: kblockd blk_mq_requeue_work\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0x91/0xf0 lib/dump_stack.c:106\n print_address_description mm/kasan/report.c:364 [inline]\n print_report+0x10d/0x610 mm/kasan/report.c:475\n kasan_report+0x8e/0xc0 mm/kasan/report.c:588\n bfq_do_early_stable_merge block/bfq-iosched.c:5692 [inline]\n bfq_do_or_sched_stable_merge block/bfq-iosched.c:5805 [inline]\n bfq_get_queue+0x25b0/0x2610 block/bfq-iosched.c:5889\n bfq_get_bfqq_handle_split+0x169/0x5d0 block/bfq-iosched.c:6757\n bfq_init_rq block/bfq-iosched.c:6876 [inline]\n bfq_insert_request block/bfq-iosched.c:6254 [inline]\n bfq_insert_requests+0x1112/0x5cf0 block/bfq-iosched.c:6304\n blk_mq_insert_request+0x290/0x8d0 block/blk-mq.c:2593\n blk_mq_requeue_work+0x6bc/0xa70 block/blk-mq.c:1502\n process_one_work kernel/workqueue.c:2627 [inline]\n process_scheduled_works+0x432/0x13f0 kernel/workqueue.c:2700\n worker_thread+0x6f2/0x1160 kernel/workqueue.c:2781\n kthread+0x33c/0x440 kernel/kthread.c:388\n ret_from_fork+0x4d/0x80 arch/x86/kernel/process.c:147\n ret_from_fork_asm+0x1b/0x30 arch/x86/entry/entry_64.S:305\n </TASK>\n\nAllocated by task 20776:\n kasan_save_stack+0x20/0x40 mm/kasan/common.c:45\n kasan_set_track+0x25/0x30 mm/kasan/common.c:52\n __kasan_slab_alloc+0x87/0x90 mm/kasan/common.c:328\n kasan_slab_alloc include/linux/kasan.h:188 [inline]\n slab_post_alloc_hook mm/slab.h:763 [inline]\n slab_alloc_node mm/slub.c:3458 [inline]\n kmem_cache_alloc_node+0x1a4/0x6f0 mm/slub.c:3503\n ioc_create_icq block/blk-ioc.c:370 [inline]\n---truncated---\n    ",
		"advisory": {
			"from": "security@suse.de",
			"severity": "Important",
			"cve": [
				{
					"text": "CVE-2024-47706 at SUSE",
					"href": "https://www.suse.com/security/cve/CVE-2024-47706/",
					"impact": "high",
					"cvss3": "7/CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H"
				},
				{
					"text": "CVE-2024-47706 at NVD",
					"href": "https://nvd.nist.gov/vuln/detail/CVE-2024-47706",
					"impact": "medium",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
				}
			],
			"bugzilla": [
				{
					"text": "SUSE bug 1231942",
					"href": "https://bugzilla.suse.com/1231942"
				},
				{
					"text": "SUSE bug 1231943",
					"href": "https://bugzilla.suse.com/1231943"
				}
			],
			"issued": {
				"date": "2024-10-23"
			},
			"updated": {
				"date": "2024-11-28"
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/o:suse:sle-live-patching:12:sp5",
					"cpe:/o:suse:sle-module-public-cloud:12",
					"cpe:/o:suse:sle-we:12:sp5",
					"cpe:/o:suse:sle_hpc:12",
					"cpe:/o:suse:sles-ltss-extended-security:12:sp5",
					"cpe:/o:suse:sles-ltss:12:sp2",
					"cpe:/o:suse:sles-ltss:12:sp4",
					"cpe:/o:suse:sles:12",
					"cpe:/o:suse:sles:12:sp3",
					"cpe:/o:suse:sles:12:sp4",
					"cpe:/o:suse:sles:12:sp5",
					"cpe:/o:suse:sles_sap:12",
					"cpe:/o:suse:sles_sap:12:sp3",
					"cpe:/o:suse:sles_sap:12:sp4",
					"cpe:/o:suse:sles_sap:12:sp5",
					"cpe:/o:suse:suse-linux-enterprise-rt:12:sp5"
				]
			}
		}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009703659",
								"comment": "SUSE Linux Enterprise High Performance Computing 12 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009178199",
								"comment": "SUSE Linux Enterprise Module for Public Cloud 12 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009116126",
								"comment": "SUSE Linux Enterprise Server 12 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009158922",
								"comment": "SUSE Linux Enterprise Server 12 SP3 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009240280",
								"comment": "SUSE Linux Enterprise Server 12 SP4 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258033",
								"comment": "SUSE Linux Enterprise Server 12 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258800",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 12 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258803",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 12 SP3 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258804",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 12 SP4 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258806",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 12 SP5 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335425",
								"comment": "kernel-default-base is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335423",
								"comment": "kernel-default-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335426",
								"comment": "kernel-default-man is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334791",
								"comment": "kernel-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334792",
								"comment": "kernel-macros is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009128018",
						"comment": "SUSE Linux Enterprise Server 12 SP2-LTSS is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338032",
								"comment": "kernel-default is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333995",
								"comment": "kernel-source is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009340767",
								"comment": "kernel-source-azure is affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009258806",
						"comment": "SUSE Linux Enterprise Server for SAP Applications 12 SP5 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258033",
								"comment": "SUSE Linux Enterprise Server 12 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258033",
								"comment": "SUSE Linux Enterprise Server 12 SP5-LTSS is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338032",
								"comment": "kernel-default is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338033",
								"comment": "kernel-default-base is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338034",
								"comment": "kernel-default-devel is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338036",
								"comment": "kernel-default-man is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335275",
								"comment": "kernel-devel is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335276",
								"comment": "kernel-macros is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333995",
								"comment": "kernel-source is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009340777",
								"comment": "kernel-devel-azure is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009340767",
								"comment": "kernel-source-azure is affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338032",
								"comment": "kernel-default is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338033",
								"comment": "kernel-default-base is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338034",
								"comment": "kernel-default-devel is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338036",
								"comment": "kernel-default-man is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335275",
								"comment": "kernel-devel is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335276",
								"comment": "kernel-macros is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333995",
								"comment": "kernel-source is affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009240280",
						"comment": "SUSE Linux Enterprise Server 12 SP4-LTSS is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338035",
								"comment": "kernel-default-kgraft is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009809200",
								"comment": "kernel-default-kgraft-devel is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333995",
								"comment": "kernel-source is affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009273148",
						"comment": "SUSE Linux Enterprise Live Patching 12 SP5 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258033",
								"comment": "SUSE Linux Enterprise Server 12 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258806",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 12 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009258650",
								"comment": "SUSE Linux Enterprise Workstation Extension 12 SP5 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009715290",
								"comment": "kernel-default-extra is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333995",
								"comment": "kernel-source is affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009728713",
								"comment": "kernel-devel-rt is affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009728714",
								"comment": "kernel-source-rt is affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009279486",
						"comment": "SUSE Linux Enterprise Real Time 12 SP5 is installed"
					}
				]
			}
		]
	}
}
