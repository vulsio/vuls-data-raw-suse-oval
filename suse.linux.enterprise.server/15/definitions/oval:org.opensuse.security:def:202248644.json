{
	"id": "oval:org.opensuse.security:def:202248644",
	"version": "1",
	"class": "vulnerability",
	"metadata": {
		"title": "CVE-2022-48644",
		"affected": {
			"family": "unix",
			"platform": [
				"SUSE Linux Enterprise Desktop 15 SP5",
				"SUSE Linux Enterprise Desktop 15 SP6",
				"SUSE Linux Enterprise High Performance Computing 15 SP5",
				"SUSE Linux Enterprise High Performance Computing 15 SP6",
				"SUSE Linux Enterprise Live Patching 15 SP5",
				"SUSE Linux Enterprise Live Patching 15 SP6",
				"SUSE Linux Enterprise Module for Basesystem 15 SP5",
				"SUSE Linux Enterprise Module for Basesystem 15 SP6",
				"SUSE Linux Enterprise Module for Development Tools 15 SP5",
				"SUSE Linux Enterprise Module for Development Tools 15 SP6",
				"SUSE Linux Enterprise Module for Legacy 15 SP5",
				"SUSE Linux Enterprise Module for Public Cloud 15 SP5",
				"SUSE Linux Enterprise Module for Public Cloud 15 SP6",
				"SUSE Linux Enterprise Server 15 SP1-LTSS",
				"SUSE Linux Enterprise Server 15 SP5",
				"SUSE Linux Enterprise Server 15 SP6",
				"SUSE Linux Enterprise Server 15-LTSS",
				"SUSE Linux Enterprise Server for SAP Applications 15 SP5",
				"SUSE Linux Enterprise Server for SAP Applications 15 SP6",
				"SUSE Linux Enterprise Workstation Extension 15 SP5"
			]
		},
		"reference": [
			{
				"ref_id": "Mitre CVE-2022-48644",
				"ref_url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-48644",
				"source": "CVE"
			},
			{
				"ref_id": "SUSE CVE-2022-48644",
				"ref_url": "https://www.suse.com/security/cve/CVE-2022-48644",
				"source": "SUSE CVE"
			},
			{
				"ref_id": "SUSE-SU-2024:1644-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-May/035263.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:1659-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-May/035281.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:1663-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-August/019268.html",
				"source": "SUSE-SU"
			}
		],
		"description": "\n    In the Linux kernel, the following vulnerability has been resolved:\n\nnet/sched: taprio: avoid disabling offload when it was never enabled\n\nIn an incredibly strange API design decision, qdisc->destroy() gets\ncalled even if qdisc->init() never succeeded, not exclusively since\ncommit 87b60cfacf9f (\"net_sched: fix error recovery at qdisc creation\"),\nbut apparently also earlier (in the case of qdisc_create_dflt()).\n\nThe taprio qdisc does not fully acknowledge this when it attempts full\noffload, because it starts off with q->flags = TAPRIO_FLAGS_INVALID in\ntaprio_init(), then it replaces q->flags with TCA_TAPRIO_ATTR_FLAGS\nparsed from netlink (in taprio_change(), tail called from taprio_init()).\n\nBut in taprio_destroy(), we call taprio_disable_offload(), and this\ndetermines what to do based on FULL_OFFLOAD_IS_ENABLED(q->flags).\n\nBut looking at the implementation of FULL_OFFLOAD_IS_ENABLED()\n(a bitwise check of bit 1 in q->flags), it is invalid to call this macro\non q->flags when it contains TAPRIO_FLAGS_INVALID, because that is set\nto U32_MAX, and therefore FULL_OFFLOAD_IS_ENABLED() will return true on\nan invalid set of flags.\n\nAs a result, it is possible to crash the kernel if user space forces an\nerror between setting q->flags = TAPRIO_FLAGS_INVALID, and the calling\nof taprio_enable_offload(). This is because drivers do not expect the\noffload to be disabled when it was never enabled.\n\nThe error that we force here is to attach taprio as a non-root qdisc,\nbut instead as child of an mqprio root qdisc:\n\n$ tc qdisc add dev swp0 root handle 1: \\\n\tmqprio num_tc 8 map 0 1 2 3 4 5 6 7 \\\n\tqueues 1@0 1@1 1@2 1@3 1@4 1@5 1@6 1@7 hw 0\n$ tc qdisc replace dev swp0 parent 1:1 \\\n\ttaprio num_tc 8 map 0 1 2 3 4 5 6 7 \\\n\tqueues 1@0 1@1 1@2 1@3 1@4 1@5 1@6 1@7 base-time 0 \\\n\tsched-entry S 0x7f 990000 sched-entry S 0x80 100000 \\\n\tflags 0x0 clockid CLOCK_TAI\nUnable to handle kernel paging request at virtual address fffffffffffffff8\n[fffffffffffffff8] pgd=0000000000000000, p4d=0000000000000000\nInternal error: Oops: 96000004 [#1] PREEMPT SMP\nCall trace:\n taprio_dump+0x27c/0x310\n vsc9959_port_setup_tc+0x1f4/0x460\n felix_port_setup_tc+0x24/0x3c\n dsa_slave_setup_tc+0x54/0x27c\n taprio_disable_offload.isra.0+0x58/0xe0\n taprio_destroy+0x80/0x104\n qdisc_create+0x240/0x470\n tc_modify_qdisc+0x1fc/0x6b0\n rtnetlink_rcv_msg+0x12c/0x390\n netlink_rcv_skb+0x5c/0x130\n rtnetlink_rcv+0x1c/0x2c\n\nFix this by keeping track of the operations we made, and undo the\noffload only if we actually did it.\n\nI've added \"bool offloaded\" inside a 4 byte hole between \"int clockid\"\nand \"atomic64_t picos_per_byte\". Now the first cache line looks like\nbelow:\n\n$ pahole -C taprio_sched net/sched/sch_taprio.o\nstruct taprio_sched {\n        struct Qdisc * *           qdiscs;               /*     0     8 */\n        struct Qdisc *             root;                 /*     8     8 */\n        u32                        flags;                /*    16     4 */\n        enum tk_offsets            tk_offset;            /*    20     4 */\n        int                        clockid;              /*    24     4 */\n        bool                       offloaded;            /*    28     1 */\n\n        /* XXX 3 bytes hole, try to pack */\n\n        atomic64_t                 picos_per_byte;       /*    32     0 */\n\n        /* XXX 8 bytes hole, try to pack */\n\n        spinlock_t                 current_entry_lock;   /*    40     0 */\n\n        /* XXX 8 bytes hole, try to pack */\n\n        struct sched_entry *       current_entry;        /*    48     8 */\n        struct sched_gate_list *   oper_sched;           /*    56     8 */\n        /* --- cacheline 1 boundary (64 bytes) --- */\n    ",
		"advisory": {
			"from": "security@suse.de",
			"severity": "Moderate",
			"cve": [
				{
					"text": "CVE-2022-48644 at SUSE",
					"href": "https://www.suse.com/security/cve/CVE-2022-48644/",
					"impact": "medium",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
				},
				{
					"text": "CVE-2022-48644 at NVD",
					"href": "https://nvd.nist.gov/vuln/detail/CVE-2022-48644"
				}
			],
			"bugzilla": [
				{
					"text": "SUSE bug 1223511",
					"href": "https://bugzilla.suse.com/1223511"
				}
			],
			"issued": {
				"date": "2024-04-30"
			},
			"updated": {
				"date": "2024-10-10"
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/o:suse:sle-module-basesystem:15:sp5",
					"cpe:/o:suse:sle-module-basesystem:15:sp6",
					"cpe:/o:suse:sle-module-development-tools:15:sp5",
					"cpe:/o:suse:sle-module-development-tools:15:sp6",
					"cpe:/o:suse:sle-module-legacy:15:sp5",
					"cpe:/o:suse:sle-module-live-patching:15:sp5",
					"cpe:/o:suse:sle-module-live-patching:15:sp6",
					"cpe:/o:suse:sle-module-public-cloud:15:sp5",
					"cpe:/o:suse:sle-module-public-cloud:15:sp6",
					"cpe:/o:suse:sle-we:15:sp5",
					"cpe:/o:suse:sle_hpc:15:sp5",
					"cpe:/o:suse:sled:15:sp5",
					"cpe:/o:suse:sles-ltss:15",
					"cpe:/o:suse:sles-ltss:15:sp1",
					"cpe:/o:suse:sles:15:sp5",
					"cpe:/o:suse:sles_sap:15:sp5"
				]
			}
		}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759899",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009760608",
								"comment": "SUSE Linux Enterprise Module for Legacy 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759901",
								"comment": "SUSE Linux Enterprise Server 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759902",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP5 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009861188",
						"comment": "reiserfs-kmp-default-5.14.21-150500.55.62.2 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759898",
								"comment": "SUSE Linux Enterprise Desktop 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759901",
								"comment": "SUSE Linux Enterprise Server 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759902",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009766857",
								"comment": "SUSE Linux Enterprise Workstation Extension 15 SP5 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009861246",
						"comment": "kernel-default-extra-5.14.21-150500.55.62.2 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856171",
								"comment": "SUSE Linux Enterprise Desktop 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856172",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856253",
								"comment": "SUSE Linux Enterprise Module for Development Tools 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856174",
								"comment": "SUSE Linux Enterprise Server 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856175",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP6 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856171",
								"comment": "SUSE Linux Enterprise Desktop 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856172",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856173",
								"comment": "SUSE Linux Enterprise Module for Basesystem 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856174",
								"comment": "SUSE Linux Enterprise Server 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856175",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP6 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335423",
								"comment": "kernel-default-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334791",
								"comment": "kernel-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334792",
								"comment": "kernel-macros is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009341508",
								"comment": "SUSE Linux Enterprise Server 15 SP1-LTSS is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009302033",
								"comment": "SUSE Linux Enterprise Server 15-LTSS is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335425",
								"comment": "kernel-default-base is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335423",
								"comment": "kernel-default-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335426",
								"comment": "kernel-default-man is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338037",
								"comment": "reiserfs-kmp-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334791",
								"comment": "kernel-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334792",
								"comment": "kernel-macros is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856172",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856320",
								"comment": "SUSE Linux Enterprise Module for Public Cloud 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856174",
								"comment": "SUSE Linux Enterprise Server 15 SP6 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009856175",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP6 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009340306",
								"comment": "kernel-devel-azure is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009340305",
								"comment": "kernel-source-azure is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009728675",
								"comment": "kernel-default-livepatch is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009728676",
								"comment": "kernel-default-livepatch-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009857543",
						"comment": "SUSE Linux Enterprise Live Patching 15 SP6 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759899",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009762868",
								"comment": "SUSE Linux Enterprise Module for Public Cloud 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759901",
								"comment": "SUSE Linux Enterprise Server 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759902",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP5 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009860709",
								"comment": "kernel-azure-5.14.21-150500.33.51.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009860710",
								"comment": "kernel-azure-devel-5.14.21-150500.33.51.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009860715",
								"comment": "kernel-devel-azure-5.14.21-150500.33.51.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009860716",
								"comment": "kernel-source-azure-5.14.21-150500.33.51.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009860717",
								"comment": "kernel-syms-azure-5.14.21-150500.33.51.1 is installed"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759898",
								"comment": "SUSE Linux Enterprise Desktop 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759899",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759900",
								"comment": "SUSE Linux Enterprise Module for Basesystem 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759901",
								"comment": "SUSE Linux Enterprise Server 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759902",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP5 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861151",
								"comment": "kernel-64kb-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861152",
								"comment": "kernel-64kb-devel-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861160",
								"comment": "kernel-default-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861161",
								"comment": "kernel-default-base-5.14.21-150500.55.62.2.150500.6.27.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861163",
								"comment": "kernel-default-devel-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861169",
								"comment": "kernel-devel-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861176",
								"comment": "kernel-macros-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861182",
								"comment": "kernel-zfcpdump-5.14.21-150500.55.62.2 is installed"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759898",
								"comment": "SUSE Linux Enterprise Desktop 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759899",
								"comment": "SUSE Linux Enterprise High Performance Computing 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009760583",
								"comment": "SUSE Linux Enterprise Module for Development Tools 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759901",
								"comment": "SUSE Linux Enterprise Server 15 SP5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009759902",
								"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP5 is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861170",
								"comment": "kernel-docs-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861177",
								"comment": "kernel-obs-build-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861179",
								"comment": "kernel-source-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861181",
								"comment": "kernel-syms-5.14.21-150500.55.62.1 is installed"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861242",
								"comment": "kernel-default-livepatch-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861243",
								"comment": "kernel-default-livepatch-devel-5.14.21-150500.55.62.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861245",
								"comment": "kernel-livepatch-5_14_21-150500_13_52-rt-1-150500.11.5.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009861244",
								"comment": "kernel-livepatch-5_14_21-150500_55_62-default-1-150500.11.3.2 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009764853",
						"comment": "SUSE Linux Enterprise Live Patching 15 SP5 is installed"
					}
				]
			}
		]
	}
}
