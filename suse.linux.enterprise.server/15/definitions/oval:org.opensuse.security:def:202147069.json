{
	"id": "oval:org.opensuse.security:def:202147069",
	"version": "1",
	"class": "vulnerability",
	"metadata": {
		"title": "CVE-2021-47069",
		"affected": {
			"family": "unix",
			"platform": [
				"SUSE Linux Enterprise Live Patching 15 SP2",
				"SUSE Linux Enterprise Live Patching 15 SP3",
				"SUSE Linux Enterprise Server 15 SP1-LTSS",
				"SUSE Linux Enterprise Server 15 SP2-LTSS",
				"SUSE Linux Enterprise Server 15 SP3-LTSS",
				"SUSE Linux Enterprise Server 15-LTSS",
				"SUSE Linux Enterprise Server for SAP Applications 15 SP2",
				"SUSE Linux Enterprise Server for SAP Applications 15 SP3"
			]
		},
		"reference": [
			{
				"ref_id": "Mitre CVE-2021-47069",
				"ref_url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47069",
				"source": "CVE"
			},
			{
				"ref_id": "SUSE CVE-2021-47069",
				"ref_url": "https://www.suse.com/security/cve/CVE-2021-47069",
				"source": "SUSE CVE"
			},
			{
				"ref_id": "SUSE-SU-2024:0856-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-March/018155.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:0857-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-March/018154.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:0926-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-March/018204.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:1454-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-April/035109.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:1489-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-August/019270.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:3565-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-security-updates/2024-October/019573.html",
				"source": "SUSE-SU"
			},
			{
				"ref_id": "SUSE-SU-2024:3585-1",
				"ref_url": "https://lists.suse.com/pipermail/sle-updates/2024-October/037202.html",
				"source": "SUSE-SU"
			}
		],
		"description": "\n    In the Linux kernel, the following vulnerability has been resolved:\n\nipc/mqueue, msg, sem: avoid relying on a stack reference past its expiry\n\ndo_mq_timedreceive calls wq_sleep with a stack local address.  The\nsender (do_mq_timedsend) uses this address to later call pipelined_send.\n\nThis leads to a very hard to trigger race where a do_mq_timedreceive\ncall might return and leave do_mq_timedsend to rely on an invalid\naddress, causing the following crash:\n\n  RIP: 0010:wake_q_add_safe+0x13/0x60\n  Call Trace:\n   __x64_sys_mq_timedsend+0x2a9/0x490\n   do_syscall_64+0x80/0x680\n   entry_SYSCALL_64_after_hwframe+0x44/0xa9\n  RIP: 0033:0x7f5928e40343\n\nThe race occurs as:\n\n1. do_mq_timedreceive calls wq_sleep with the address of `struct\n   ext_wait_queue` on function stack (aliased as `ewq_addr` here) - it\n   holds a valid `struct ext_wait_queue *` as long as the stack has not\n   been overwritten.\n\n2. `ewq_addr` gets added to info->e_wait_q[RECV].list in wq_add, and\n   do_mq_timedsend receives it via wq_get_first_waiter(info, RECV) to call\n   __pipelined_op.\n\n3. Sender calls __pipelined_op::smp_store_release(&this->state,\n   STATE_READY).  Here is where the race window begins.  (`this` is\n   `ewq_addr`.)\n\n4. If the receiver wakes up now in do_mq_timedreceive::wq_sleep, it\n   will see `state == STATE_READY` and break.\n\n5. do_mq_timedreceive returns, and `ewq_addr` is no longer guaranteed\n   to be a `struct ext_wait_queue *` since it was on do_mq_timedreceive's\n   stack.  (Although the address may not get overwritten until another\n   function happens to touch it, which means it can persist around for an\n   indefinite time.)\n\n6. do_mq_timedsend::__pipelined_op() still believes `ewq_addr` is a\n   `struct ext_wait_queue *`, and uses it to find a task_struct to pass to\n   the wake_q_add_safe call.  In the lucky case where nothing has\n   overwritten `ewq_addr` yet, `ewq_addr->task` is the right task_struct.\n   In the unlucky case, __pipelined_op::wake_q_add_safe gets handed a\n   bogus address as the receiver's task_struct causing the crash.\n\ndo_mq_timedsend::__pipelined_op() should not dereference `this` after\nsetting STATE_READY, as the receiver counterpart is now free to return.\nChange __pipelined_op to call wake_q_add_safe on the receiver's\ntask_struct returned by get_task_struct, instead of dereferencing `this`\nwhich sits on the receiver's stack.\n\nAs Manfred pointed out, the race potentially also exists in\nipc/msg.c::expunge_all and ipc/sem.c::wake_up_sem_queue_prepare.  Fix\nthose in the same way.\n    ",
		"advisory": {
			"from": "security@suse.de",
			"severity": "Moderate",
			"cve": [
				{
					"text": "CVE-2021-47069 at SUSE",
					"href": "https://www.suse.com/security/cve/CVE-2021-47069/",
					"impact": "medium",
					"cvss3": "4.7/CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H"
				},
				{
					"text": "CVE-2021-47069 at NVD",
					"href": "https://nvd.nist.gov/vuln/detail/CVE-2021-47069",
					"impact": "high",
					"cvss3": "7/CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H"
				}
			],
			"bugzilla": [
				{
					"text": "SUSE bug 1220826",
					"href": "https://bugzilla.suse.com/1220826"
				}
			],
			"issued": {
				"date": "2024-03-07"
			},
			"updated": {
				"date": "2025-01-10"
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/o:suse:sle-module-live-patching:15:sp2",
					"cpe:/o:suse:sle-module-live-patching:15:sp3",
					"cpe:/o:suse:sles-ltss:15",
					"cpe:/o:suse:sles-ltss:15:sp1",
					"cpe:/o:suse:sles-ltss:15:sp2",
					"cpe:/o:suse:sles-ltss:15:sp3",
					"cpe:/o:suse:sles_sap:15:sp2",
					"cpe:/o:suse:sles_sap:15:sp3"
				]
			}
		}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009341508",
								"comment": "SUSE Linux Enterprise Server 15 SP1-LTSS is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009302033",
								"comment": "SUSE Linux Enterprise Server 15-LTSS is installed"
							}
						]
					},
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334017",
								"comment": "kernel-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335425",
								"comment": "kernel-default-base is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335423",
								"comment": "kernel-default-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009335426",
								"comment": "kernel-default-man is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009338037",
								"comment": "reiserfs-kmp-default is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334791",
								"comment": "kernel-devel is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009334792",
								"comment": "kernel-macros is not affected"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009333928",
								"comment": "kernel-source is not affected"
							}
						]
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946374",
								"comment": "kernel-default-livepatch-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946375",
								"comment": "kernel-default-livepatch-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009851659",
								"comment": "kernel-livepatch-5_3_18-150200_24_183-default-1-150200.5.3.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009858122",
								"comment": "kernel-livepatch-5_3_18-150200_24_188-default-1-150200.5.3.3 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946376",
								"comment": "kernel-livepatch-5_3_18-150200_24_206-default-1-150200.5.3.1 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009288462",
						"comment": "SUSE Linux Enterprise Live Patching 15 SP2 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946392",
								"comment": "kernel-default-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946393",
								"comment": "kernel-default-base-5.3.18-150200.24.206.1.150200.9.107.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946394",
								"comment": "kernel-default-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946384",
								"comment": "kernel-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946385",
								"comment": "kernel-docs-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946386",
								"comment": "kernel-macros-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946395",
								"comment": "kernel-obs-build-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946388",
								"comment": "kernel-preempt-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946389",
								"comment": "kernel-preempt-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946390",
								"comment": "kernel-source-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946396",
								"comment": "kernel-syms-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946397",
								"comment": "reiserfs-kmp-default-5.3.18-150200.24.206.1 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009660213",
						"comment": "SUSE Linux Enterprise Server 15 SP2-LTSS is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946398",
								"comment": "kernel-default-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946399",
								"comment": "kernel-default-base-5.3.18-150200.24.206.1.150200.9.107.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946400",
								"comment": "kernel-default-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946384",
								"comment": "kernel-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946385",
								"comment": "kernel-docs-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946386",
								"comment": "kernel-macros-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946401",
								"comment": "kernel-obs-build-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946402",
								"comment": "kernel-preempt-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946403",
								"comment": "kernel-preempt-devel-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946390",
								"comment": "kernel-source-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946404",
								"comment": "kernel-syms-5.3.18-150200.24.206.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946405",
								"comment": "reiserfs-kmp-default-5.3.18-150200.24.206.1 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009659637",
						"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP2 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946675",
								"comment": "kernel-default-livepatch-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946676",
								"comment": "kernel-default-livepatch-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009850567",
								"comment": "kernel-livepatch-5_3_18-150300_59_153-default-1-150300.7.3.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009858801",
								"comment": "kernel-livepatch-5_3_18-150300_59_158-default-1-150300.7.3.5 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946677",
								"comment": "kernel-livepatch-5_3_18-150300_59_179-default-1-150300.7.3.2 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009478738",
						"comment": "SUSE Linux Enterprise Live Patching 15 SP3 is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946682",
								"comment": "kernel-64kb-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946683",
								"comment": "kernel-64kb-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946696",
								"comment": "kernel-default-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946697",
								"comment": "kernel-default-base-5.3.18-150300.59.179.1.150300.18.105.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946698",
								"comment": "kernel-default-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946687",
								"comment": "kernel-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946688",
								"comment": "kernel-docs-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946689",
								"comment": "kernel-macros-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946699",
								"comment": "kernel-obs-build-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946691",
								"comment": "kernel-preempt-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946692",
								"comment": "kernel-preempt-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946693",
								"comment": "kernel-source-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946700",
								"comment": "kernel-syms-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946701",
								"comment": "kernel-zfcpdump-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946702",
								"comment": "reiserfs-kmp-default-5.3.18-150300.59.179.1 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009729178",
						"comment": "SUSE Linux Enterprise Server 15 SP3-LTSS is installed"
					}
				]
			},
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterions": [
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946703",
								"comment": "kernel-default-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946704",
								"comment": "kernel-default-base-5.3.18-150300.59.179.1.150300.18.105.2 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946705",
								"comment": "kernel-default-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946687",
								"comment": "kernel-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946688",
								"comment": "kernel-docs-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946689",
								"comment": "kernel-macros-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946706",
								"comment": "kernel-obs-build-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946707",
								"comment": "kernel-preempt-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946708",
								"comment": "kernel-preempt-devel-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946693",
								"comment": "kernel-source-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946709",
								"comment": "kernel-syms-5.3.18-150300.59.179.1 is installed"
							},
							{
								"test_ref": "oval:org.opensuse.security:tst:2009946710",
								"comment": "reiserfs-kmp-default-5.3.18-150300.59.179.1 is installed"
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:org.opensuse.security:tst:2009669878",
						"comment": "SUSE Linux Enterprise Server for SAP Applications 15 SP3 is installed"
					}
				]
			}
		]
	}
}
